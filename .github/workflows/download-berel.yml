name: Download BEREL Model

on:
  workflow_dispatch:
    inputs:
      model_name:
        description: 'BEREL model version'
        required: false
        default: 'dicta-il/BEREL'
        type: string

jobs:
  download-berel:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          pip install transformers torch huggingface-hub
      
      - name: Download BEREL model
        run: |
          python -c "
          from transformers import AutoTokenizer, AutoModel
          import os
          
          model_name = '${{ inputs.model_name }}'
          save_dir = 'downloaded_models/berel'
          
          print(f'ğŸ“¥ ××•×¨×™×“ ××ª {model_name}...')
          print(f'ğŸ’¾ ×©×•××¨ ×‘-{save_dir}')
          
          os.makedirs(save_dir, exist_ok=True)
          
          # Download tokenizer
          print('ğŸ”¤ ××•×¨×™×“ tokenizer...')
          tokenizer = AutoTokenizer.from_pretrained(model_name, trust_remote_code=True)
          tokenizer.save_pretrained(save_dir)
          print('âœ… Tokenizer ×”×•×¨×“')
          
          # Download model
          print('ğŸ§  ××•×¨×™×“ model...')
          model = AutoModel.from_pretrained(model_name, trust_remote_code=True)
          model.save_pretrained(save_dir)
          print('âœ… Model ×”×•×¨×“')
          
          print(f'âœ¨ BEREL ×”×•×¨×“ ×‘×”×¦×œ×—×”!')
          print(f'ğŸ“‚ × ××¦× ×‘-{save_dir}')
          "
      
      - name: Create zip archive
        run: |
          cd downloaded_models
          zip -r berel.zip berel/
          echo "ğŸ“¦ ×™×¦×¨×ª×™ ×§×•×‘×¥ ZIP: berel.zip"
      
      - name: Get file size
        run: |
          du -sh downloaded_models/berel
          du -sh downloaded_models/berel.zip
      
      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: berel-${{ github.run_number }}
          release_name: BEREL Model (Rabbinic Hebrew + Aramaic)
          body: |
            ğŸ¯ **BEREL - ×¢×‘×¨×™×ª ×¨×‘× ×™×ª + ××¨××™×ª**
            
            ××•×“×œ BERT ××™×•×—×“ ×œ××˜×¨×•×ª:
            - âœ… ×¢×‘×¨×™×ª ×¨×‘× ×™×ª (×ª×œ××•×“, ××“×¨×©×™×, ×¨××©×•× ×™×)
            - âœ… ××¨××™×ª ×ª×œ××•×“×™×ª
            - âœ… ×¦×™×¨×•×¤×™× ×¨×‘× ×™×™×
            - âœ… ×œ×©×•×Ÿ ×—×›××™×
            
            ğŸ“¥ ×”×•×¨×“ ××ª `berel.zip`
            ğŸ“‚ ×—×œ×¥ ×œ×ª×™×§×™×™×ª `downloaded_models/berel`
            
            ğŸ”§ **×©×™××•×©:**
            ```python
            from transformers import AutoTokenizer, AutoModel
            
            tokenizer = AutoTokenizer.from_pretrained(
                "downloaded_models/berel",
                trust_remote_code=True,
                local_files_only=True
            )
            model = AutoModel.from_pretrained(
                "downloaded_models/berel",
                trust_remote_code=True,
                local_files_only=True
            )
            ```
            
            â­ **×œ××” BEREL?**
            - ×××•××Ÿ ×¡×¤×¦×™×¤×™×ª ×¢×œ ×˜×§×¡×˜×™× ×¨×‘× ×™×™×
            - ××‘×™×Ÿ ××¨××™×ª ×ª×œ××•×“×™×ª
            - ×“×™×•×§ ×’×‘×•×” ×™×•×ª×¨ ×œ×¢×‘×¨×™×ª ×¨×‘× ×™×ª ×-DictaBERT ×¨×’×™×œ
            
            **×’×•×“×œ:** ~400-800MB
            **×”×•×¨×“:** ${{ github.run_number }}
          draft: false
          prerelease: false
      
      - name: Upload Release Asset
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./downloaded_models/berel.zip
          asset_name: berel.zip
          asset_content_type: application/zip
      
      - name: Success message
        run: |
          echo "âœ… BEREL ×”×•×¨×“ ×•×”×•×¢×œ×” ×œ-GitHub Releases!"
          echo "ğŸ“¦ ×§×•×‘×¥: berel.zip"
          echo "ğŸ”— ×’×© ×œ-Releases ×›×“×™ ×œ×”×•×¨×™×“"
